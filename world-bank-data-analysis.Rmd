---
title: "World Bank Data Analysis"
author: "Adrian Glapi≈Ñski"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output: 
  html_document: 
    keep_md: false
    df_print: kable
    #code_folding: "hide"
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Executive summary
TODO

## Used libraries

```{r load-libraries, message=FALSE, collapse=FALSE}
library(kableExtra)
library(DT)

library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)

library(skimr)
library(gtsummary)
#library(summarytools)
#library(desctable)
```

## Load data
```{r load-data, message=FALSE}
wdi_df <- read_excel('./data/World_Development_Indicators.xlsx', 
                 na = c('', '..')) %>% head(-5)

currency_df <- read_csv('./data/CurrencyExchangeRates.csv', 
                        col_types = cols(Date = col_date("%Y-%m-%d")))

# https://data.nasdaq.com/data/LBMA/GOLD-gold-price-london-fixing
gold_prices_df <- read_csv('./data/Gold prices.csv')

# https://data.nasdaq.com/data/YALE/SPCOMP-sp-composite
sp_df <- read_csv('./data/S&P Composite.csv')

# https://data.nasdaq.com/data/BCHAIN-blockchain
btc_diff_df <- read_csv('./data/bitcoin/BCHAIN-DIFF.csv')
btc_hrate_df <- read_csv('./data/bitcoin/BCHAIN-HRATE.csv')
btc_mkpru_df <- read_csv('./data/bitcoin/BCHAIN-MKPRU.csv')
btc_trvou_df <- read_csv('./data/bitcoin/BCHAIN-TRVOU.csv')
```

## Clean data sets

```{r clean-data-sets}
wdi_cleaned_df <- wdi_df %>%
  select(-c(`Country Code`, `Series Code`)) %>%
  pivot_longer(-c(`Country Name`, `Series Name`), names_to = 'Year') %>%
  pivot_wider(names_from = `Series Name`) %>%
  mutate(`Country Name` = as_factor(`Country Name`),
         Year = as.numeric(word(Year))) %>%
  clean_names()

#currency_df <- clean_names(currency_df)
currency_df <- currency_df %>%
  pivot_longer(cols = -Date, names_to = 'currency',
               values_to = 'exchange_rate') %>%
  clean_names() %>%
  mutate(currency = as_factor(currency))

gold_prices_df <- clean_names(gold_prices_df)

sp_df <- clean_names(sp_df) %>% rename(date = year)

btc_diff_df <- clean_names(btc_diff_df)
btc_hrate_df <- clean_names(btc_hrate_df)
btc_mkpru_df <- clean_names(btc_mkpru_df)
btc_trvou_df <- clean_names(btc_trvou_df)

btc_df <- btc_diff_df %>%
  full_join(btc_hrate_df, by = 'date', suffix = c('_diff', '_hrate')) %>%
  full_join(btc_mkpru_df, by = 'date') %>% 
  full_join(btc_trvou_df, by = 'date', suffix = c('_mkpru', '_trvou')) %>%
  rename(difficulty = value_diff,
         hash_rate = value_hrate,
         market_price_usd = value_mkpru,
         exchange_trade_volume_usd = value_trvou)
```

## WDI data set summary

```{r wdi-data-set-summary}
wdi_skimmed_df <- skim(wdi_cleaned_df) 
summary(wdi_skimmed_df)
wdi_skimmed_df %>%
  yank('factor') %>% 
  clean_names(case = 'title') %>%
  datatable(options = list(scrollX = TRUE))
wdi_skimmed_df %>%
  yank('numeric') %>% 
  clean_names(case = 'title') %>%
  datatable(options = list(scrollX = TRUE)) %>% 
  formatRound(3:10)
```

```{r wdi-data-subset}
wdi_subset_df <- wdi_cleaned_df %>%
  select(country_name, year,
         access_to_electricity_percent_of_population,
         birth_rate_crude_per_1_000_people,
         co2_emissions_metric_tons_per_capita,
         consumer_price_index_2010_100,
         expense_percent_of_gdp,
         exports_of_goods_and_services_current_us,
         gdp_current_us,
         gdp_growth_annual_percent,
         gdp_per_capita_current_us,
         gdp_per_capita_growth_annual_percent,
         gni_growth_annual_percent,
         imports_of_goods_and_services_current_us,
         inflation_consumer_prices_annual_percent,
         life_expectancy_at_birth_total_years,
         literacy_rate_adult_total_percent_of_people_ages_15_and_above,
         mortality_rate_infant_per_1_000_live_births,
         population_ages_0_14_percent_of_total_population,
         population_ages_15_64_percent_of_total_population,
         population_ages_65_and_above_percent_of_total_population,
         population_growth_annual_percent,
         population_total,
         prevalence_of_undernourishment_percent_of_population,
         real_interest_rate_percent,
         s_p_global_equity_indices_annual_percent_change,
         survival_to_age_65_female_percent_of_cohort,
         survival_to_age_65_male_percent_of_cohort,
         tax_revenue_percent_of_gdp,
         unemployment_total_percent_of_total_labor_force_national_estimate,
         urban_population_percent_of_total_population,
         urban_population_growth_annual_percent)
```
